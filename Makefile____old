ROOT_DIR:=$(shell dirname $(realpath $(firstword $(MAKEFILE_LIST))))

OWN_INCLUDES = \
	-I$(ROOT_DIR)/src/Domain \
	-I$(ROOT_DIR)/src/Vk \
	-I$(ROOT_DIR)/src/Ui \
	-I$(ROOT_DIR)/src/Service

ADD_INCLUDES = \
	-I/opt/bullet3-master/src \
	-I/opt/vk_mem_alloc \
	-I/opt/stb_image \
	-I/opt/tiny_obj_loader/ \
	-I/opt/imgui-vulkan/ 

BULLET_INCLUDE_PATHS_LIBS = -L/opt/bullet3-master/src/BulletCollision/ \
							-L/opt/bullet3-master/src/BulletDynamics/ \
							-L/opt/bullet3-master/src/LinearMath/ \
							-lBulletDynamics -lBulletCollision -lLinearMath

VULKAN_SDK_PATH = /opt/Vulkan_SDK/1.2.162.1/x86_64

CFLAGS = -std=c++17 -I$(VULKAN_SDK_PATH)/include $(OWN_INCLUDES) $(ADD_INCLUDES)
LDFLAGS = -L$(VULKAN_SDK_PATH)/lib `pkg-config --static --libs glfw3` -lvulkan $(BULLET_INCLUDE_PATHS_LIBS)

IMGUI_CPP_PATHS = /opt/imgui-vulkan/*.cpp

OWN_CPP_PATHS = src/*.cpp src/Domain/*.cpp src/Vk/*.cpp src/Ui/*.cpp src/Service/*.cpp

###### Unit Testing Paths
UNIT_TEST_INCLUDE = -I/opt/catch-header/
UNIT_TESTS_PATH = $(ROOT_DIR)/unit_tests/*.cpp


VulkanRun: $(OWN_CPP_PATHS) $(IMGUI_CPP_PATHS)
	g++ $(CFLAGS) -o VulkanRun $(OWN_CPP_PATHS) $(IMGUI_CPP_PATHS) $(LDFLAGS)

Unit_Test: $(UNIT_TESTS_PATH) src/Domain/*.cpp src/Vk/*.cpp src/Ui/*.cpp src/Service/*.cpp $(IMGUI_CPP_PATHS)
	g++ $(UNIT_TEST_INCLUDE) $(CFLAGS) -o Unit_Test $(UNIT_TESTS_PATH) src/Domain/*.cpp src/Vk/*.cpp src/Ui/*.cpp src/Service/*.cpp $(IMGUI_CPP_PATHS) $(LDFLAGS) 

VulkanDebug: $(OWN_CPP_PATHS) $(IMGUI_CPP_PATHS)
	g++ $(CFLAGS) -g -o VulkanDebug $(OWN_CPP_PATHS) $(IMGUI_CPP_PATHS) $(LDFLAGS)

VulkanOpt: $(OWN_CPP_PATHS) $(IMGUI_CPP_PATHS)
	g++ $(CFLAGS) -O3 -o VulkanOpt $(OWN_CPP_PATHS) $(IMGUI_CPP_PATHS) $(LDFLAGS)

.PHONY: test clean

run: VulkanRun
	LD_LIBRARY_PATH=$(VULKAN_SDK_PATH)/lib
	VK_LAYER_PATH=$(VULKAN_SDK_PATH)/etc/vulkan/explicit_layer.d 
	./VulkanRun

test: Unit_Test
	LD_LIBRARY_PATH=$(VULKAN_SDK_PATH)/lib
	VK_LAYER_PATH=$(VULKAN_SDK_PATH)/etc/vulkan/explicit_layer.d 
	./Unit_Test

debug: VulkanDebug
	LD_LIBRARY_PATH=$(VULKAN_SDK_PATH)/lib
	VK_LAYER_PATH=$(VULKAN_SDK_PATH)/etc/vulkan/explicit_layer.d 

optimise: VulkanOpt
	LD_LIBRARY_PATH=$(VULKAN_SDK_PATH)/lib
	VK_LAYER_PATH=$(VULKAN_SDK_PATH)/etc/vulkan/explicit_layer.d 
	./VulkanOpt

7 clean:
	rm -f VulkanRun
	rm -f Unit_Test
	rm -f VulkanDebug
	rm -f VulkanOpt